name: "æ„å»º Tailscaleï¼ˆAPK + IPK å¹¶è¡Œï¼‰"

on:
  workflow_dispatch:
  schedule:
    - cron: '0 23 * * *'

permissions:
  contents: write

jobs:
  # ========================================
  # ä»»åŠ¡ 1: æ£€æŸ¥ç‰ˆæœ¬å¹¶å‡†å¤‡æºç 
  # ========================================
  prepare:
    runs-on: ubuntu-latest
    outputs:
      skip: ${{ steps.version.outputs.skip }}
      version: ${{ steps.version.outputs.version }}
      tag: ${{ steps.version.outputs.tag }}
      build_time: ${{ steps.build_time.outputs.time }}
    steps:
      - name: "ğŸ“¥ æ£€å‡ºä»£ç "
        uses: actions/checkout@v4

      - name: "ğŸ” æ£€æŸ¥ä¸Šæ¸¸ç‰ˆæœ¬"
        id: version
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“Š ç‰ˆæœ¬æ£€æŸ¥"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          
          echo "ğŸ“¡ è·å–ä¸Šæ¸¸æœ€æ–°ç‰ˆæœ¬..."
          upstream=$(curl -s "https://api.github.com/repos/asvow/luci-app-tailscale/tags" | jq -r '.[0].name // "none"')
          
          echo "ğŸ“¦ è·å–å½“å‰ä»“åº“ç‰ˆæœ¬..."
          current=$(curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/tags" | jq -r '.[0].name // "none"')
          
          echo ""
          echo "  ä¸Šæ¸¸ç‰ˆæœ¬: $upstream"
          echo "  å½“å‰ç‰ˆæœ¬: $current"
          echo ""
          
          if [ "$upstream" = "$current" ]; then
            echo "âœ… ç‰ˆæœ¬ä¸€è‡´ï¼Œè·³è¿‡æ„å»º"
            echo "skip=true" >> $GITHUB_OUTPUT
          else
            echo "ğŸ†• å‘ç°æ–°ç‰ˆæœ¬ï¼Œå¼€å§‹æ„å»º"
            echo "skip=false" >> $GITHUB_OUTPUT
            version_number=$(echo "$upstream" | sed 's/^v//')
            echo "version=$version_number" >> $GITHUB_OUTPUT
            echo "tag=$upstream" >> $GITHUB_OUTPUT
          fi
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

      - name: "ğŸ“… ç”Ÿæˆæ„å»ºæ—¶é—´"
        id: build_time
        if: steps.version.outputs.skip == 'false'
        run: |
          BUILD_TIME=$(TZ=Asia/Shanghai date +'%Y-%m-%d %H:%M:%S')
          echo "time=$BUILD_TIME" >> $GITHUB_OUTPUT
          echo "â° æ„å»ºæ—¶é—´: $BUILD_TIME CST"

      - name: "ğŸ“¦ æ‹‰å–æºç "
        if: steps.version.outputs.skip == 'false'
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“¥ å…‹éš†æºç "
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          git clone https://github.com/asvow/luci-app-tailscale luci-app-tailscale
          cd luci-app-tailscale
          echo "âœ… æºç å…‹éš†å®Œæˆ"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

      - name: "ğŸ”§ ä¿®æ”¹æºç "
        if: steps.version.outputs.skip == 'false'
        run: |
          cd luci-app-tailscale
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ”§ å¼€å§‹æºç ä¿®æ”¹"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          
          echo "1ï¸âƒ£ ä¿®æ”¹ Makefile - æ·»åŠ é…ç½®æ–‡ä»¶ä¿æŠ¤"
          if ! grep -q "define Package/luci-app-tailscale/conffiles" Makefile; then
            sed -i '/^PKG_VERSION:=/a\\ndefine Package/luci-app-tailscale/conffiles\n/etc/config/tailscale\n/etc/config/tailscale_data/\nendef' Makefile
            echo "   âœ… å·²æ·»åŠ  conffiles å®šä¹‰"
          else
            echo "   âš ï¸  conffiles å®šä¹‰å·²å­˜åœ¨"
          fi
          
          echo ""
          echo "2ï¸âƒ£ ä¿®æ”¹é»˜è®¤é…ç½®è·¯å¾„"
          sed -i "s|'/etc/tailscale'|'/etc/config/tailscale_data'|g" root/etc/config/tailscale
          echo "   âœ… é…ç½®è·¯å¾„: /etc/tailscale â†’ /etc/config/tailscale_data"
          
          echo ""
          echo "3ï¸âƒ£ ä¿®æ”¹ init.d è„šæœ¬"
          sed -i 's|/var/lib/tailscale|/var/run/tailscale|g' root/etc/init.d/tailscale
          sed -i '/rm -rf "$CONFIG_PATH"/i\	# åªåˆ é™¤ä¸´æ—¶ç›®å½•ï¼Œä¿æŠ¤æ•°æ®ç›®å½•' root/etc/init.d/tailscale
          echo "   âœ… ä¸´æ—¶ç›®å½•: /var/lib/tailscale â†’ /var/run/tailscale"
          
          echo ""
          echo "4ï¸âƒ£ ä¿®æ”¹ LuCI ç•Œé¢ JS"
          sed -i "s|'/etc/tailscale'|'/etc/config/tailscale_data'|g" htdocs/luci-static/resources/view/tailscale/setting.js
          echo "   âœ… ç•Œé¢é»˜è®¤è·¯å¾„å·²æ›´æ–°"
          
          echo ""
          echo "5ï¸âƒ£ ç”Ÿæˆ uci-defaults è„šæœ¬"
          mkdir -p root/etc/uci-defaults
          cat > root/etc/uci-defaults/40_luci-tailscale <<'EOF'
          #!/bin/sh
          D="/etc/config/tailscale_data"
          [ -f "$D/.initialized" ] && grep -q "config tailscale 'settings'" /etc/config/tailscale 2>/dev/null && grep -q "option config_path '$D'" /etc/config/tailscale && exit 0
          rm -f /etc/config/tailscale-opkg
          [ -f /etc/config/tailscale ] && {
            sed -i "s|^config settings|config tailscale|g;/option state_file/d;s|'/etc/tailscale'|'$D'|g" /etc/config/tailscale
            grep -q "option config_path" /etc/config/tailscale || sed -i "/option port/a\\	option config_path '$D'" /etc/config/tailscale
            grep -q "option accept_dns" /etc/config/tailscale || sed -i "/option fw_mode/a\\	option accept_dns '1'" /etc/config/tailscale
            [ -f /etc/tailscale/tailscaled.state ] && { mkdir -p "$D"; cp -a /etc/tailscale/tailscaled.state "$D/"; }
          }
          mkdir -p "$D" && touch "$D/.initialized"
          uci -q delete ucitrack.@tailscale[-1] 2>/dev/null; uci -q commit ucitrack 2>/dev/null
          rm -f /tmp/luci-indexcache
          EOF
          chmod +x root/etc/uci-defaults/40_luci-tailscale
          echo "   âœ… uci-defaults è„šæœ¬å·²ç”Ÿæˆ"
          
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… æ‰€æœ‰ä¿®æ”¹å®Œæˆ"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

      - name: "ğŸ“¤ ä¸Šä¼ æºç "
        if: steps.version.outputs.skip == 'false'
        uses: actions/upload-artifact@v4
        with:
          name: source
          path: luci-app-tailscale/

  # ========================================
  # ä»»åŠ¡ 2: å¹¶è¡Œç¼–è¯‘ APK å’Œ IPK
  # ========================================
  build:
    needs: prepare
    if: needs.prepare.outputs.skip == 'false'
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        include:
          - name: "OpenWrt ä¸»çº¿ (APK)"
            arch: x86_64
            sdk: SNAPSHOT
            pkg_type: apk
            
          - name: "OpenWrt 24.10 (IPK)"
            arch: x86_64
            sdk: openwrt-24.10
            pkg_type: ipk

    name: "ğŸ”¨ ${{ matrix.name }}"

    outputs:
      apk_status: ${{ steps.build_status.outputs.apk_status }}
      ipk_status: ${{ steps.build_status.outputs.ipk_status }}

    steps:
      - name: "ğŸ“¥ æ£€å‡ºä»£ç "
        uses: actions/checkout@v4

      - name: "ğŸ“¦ ä¸‹è½½æºç "
        uses: actions/download-artifact@v4
        with:
          name: source
          path: luci-app-tailscale

      - name: "ğŸ”¨ ç¼–è¯‘ ${{ matrix.pkg_type }}"
        id: compile
        continue-on-error: true
        uses: sbwml/openwrt-gh-action-sdk@go1.25
        env:
          ARCH: ${{ matrix.arch }}-${{ matrix.sdk }}
          FEEDNAME: packages_ci
          PACKAGES: luci-app-tailscale
          NO_REFRESH_CHECK: true

      - name: "ğŸ“‹ åˆ—å‡ºç¼–è¯‘äº§ç‰©"
        id: list_files
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“¦ ç¼–è¯‘äº§ç‰© (${{ matrix.pkg_type }})"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          
          # æ£€æŸ¥æ˜¯å¦æœ‰ç¼–è¯‘äº§ç‰©
          if [ -d "bin/packages/${{ matrix.arch }}/packages_ci" ]; then
            FILES=$(find bin/packages/${{ matrix.arch }}/packages_ci -name "*luci*tailscale*.${{ matrix.pkg_type }}" -exec basename {} \;)
            if [ -n "$FILES" ]; then
              echo "$FILES" | while read file; do
                size=$(find bin/packages/${{ matrix.arch }}/packages_ci -name "$file" -exec ls -lh {} \; | awk '{print $5}')
                echo "  âœ… $file ($size)"
              done
              
              # ä¿å­˜æ–‡ä»¶åˆ—è¡¨åˆ°è¾“å‡º
              echo "files<<EOF" >> $GITHUB_OUTPUT
              echo "$FILES" >> $GITHUB_OUTPUT
              echo "EOF" >> $GITHUB_OUTPUT
              
              echo "status=success" >> $GITHUB_OUTPUT
            else
              echo "  âŒ æœªæ‰¾åˆ°ç¼–è¯‘äº§ç‰©"
              echo "status=failed" >> $GITHUB_OUTPUT
            fi
          else
            echo "  âŒ ç¼–è¯‘ç›®å½•ä¸å­˜åœ¨"
            echo "status=failed" >> $GITHUB_OUTPUT
          fi
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

      - name: "ğŸ“¤ ä¸Šä¼ äº§ç‰©åˆ° Artifacts"
        if: steps.list_files.outputs.status == 'success'
        uses: actions/upload-artifact@v4
        with:
          name: packages-${{ matrix.pkg_type }}
          path: bin/packages/${{ matrix.arch }}/packages_ci/*luci*tailscale*

      - name: "ğŸ“¦ æ‰“åŒ…å‹ç¼©"
        if: steps.list_files.outputs.status == 'success'
        run: |
          echo "ğŸ“¦ æ‰“åŒ… ${{ matrix.pkg_type }} æ–‡ä»¶..."
          cd bin/packages/${{ matrix.arch }}/packages_ci
          tar -czf ../../../../${{ matrix.pkg_type }}-packages.tar.gz *luci*tailscale*
          
          echo ""
          echo "âœ… æ‰“åŒ…å®Œæˆ"
          ls -lh ../../../../${{ matrix.pkg_type }}-packages.tar.gz

      - name: "ğŸš€ å‘å¸ƒåˆ° GitHub Release"
        if: steps.list_files.outputs.status == 'success'
        uses: ncipollo/release-action@v1
        with:
          tag: ${{ needs.prepare.outputs.tag }}
          name: "luci-app-tailscale ${{ needs.prepare.outputs.version }}"
          token: ${{ secrets.GITHUB_TOKEN }}
          allowUpdates: true
          replacesArtifacts: true
          artifacts: "${{ matrix.pkg_type }}-packages.tar.gz"
          body: |
            ## ğŸ“¦ ä¸‹è½½åŒ…
            
            - **apk-packages.tar.gz** - OpenWrt ä¸»çº¿ (SNAPSHOT)
            - **ipk-packages.tar.gz** - OpenWrt 24.10
            
            æ¯ä¸ªå‹ç¼©åŒ…åŒ…å«ï¼š
            - `luci-app-tailscale` - ä¸»ç¨‹åºåŒ…
            - `luci-i18n-tailscale-zh-cn` - ç®€ä½“ä¸­æ–‡è¯­è¨€åŒ…
            - `luci-i18n-tailscale-zh-tw` - ç¹ä½“ä¸­æ–‡è¯­è¨€åŒ…
            
            ## ğŸ“¥ å®‰è£…æ–¹æ³•
            
            ### APK æ ¼å¼ï¼ˆOpenWrt ä¸»çº¿ï¼‰
            ```bash
            # è§£å‹
            tar -xzf apk-packages.tar.gz
            
            # å®‰è£…ä¸»ç¨‹åº
            apk add --allow-untrusted luci-app-tailscale-*.apk
            
            # å®‰è£…ä¸­æ–‡è¯­è¨€åŒ…ï¼ˆå¯é€‰ï¼‰
            apk add --allow-untrusted luci-i18n-tailscale-zh-cn-*.apk
            ```
            
            ### IPK æ ¼å¼ï¼ˆOpenWrt 24.10ï¼‰
            ```bash
            # è§£å‹
            tar -xzf ipk-packages.tar.gz
            
            # å®‰è£…ä¸»ç¨‹åº
            opkg install luci-app-tailscale_*_all.ipk
            
            # å®‰è£…ä¸­æ–‡è¯­è¨€åŒ…ï¼ˆå¯é€‰ï¼‰
            opkg install luci-i18n-tailscale-zh-cn_*_all.ipk
            ```
            
            ## ğŸ”§ é…ç½®è¯´æ˜
            
            **é…ç½®æ–‡ä»¶ä½ç½®**ï¼š
            - UCI é…ç½®ï¼š`/etc/config/tailscale`
            - æ•°æ®ç›®å½•ï¼š`/etc/config/tailscale_data/`
            - æˆæƒæ–‡ä»¶ï¼š`/etc/config/tailscale_data/tailscaled.state`
            
            **ç‰¹æ€§**ï¼š
            - âœ… é‡æ–°å®‰è£…æ—¶è‡ªåŠ¨ä¿ç•™é…ç½®
            - âœ… å›ºä»¶å‡çº§æ—¶ä¿ç•™é…ç½®å’Œæˆæƒä¿¡æ¯
            - âœ… è‡ªåŠ¨ä¿®å¤å®˜æ–¹ tailscale åŒ…çš„é…ç½®é—®é¢˜
            
            ## ğŸ“Œ ç‰ˆæœ¬ä¿¡æ¯
            
            - **ä¸Šæ¸¸ç‰ˆæœ¬**ï¼š${{ needs.prepare.outputs.tag }}
            - **æ„å»ºæ—¶é—´**ï¼š${{ needs.prepare.outputs.build_time }} CST
            - **é€‚ç”¨ç³»ç»Ÿ**ï¼šOpenWrt / ImmortalWrt
            
            ## âš ï¸ æ³¨æ„äº‹é¡¹
            
            1. æœ¬åŒ…ä»…åŒ…å« LuCI ç•Œé¢æ’ä»¶å’Œè¯­è¨€åŒ…
            2. `tailscale` ä¸»ç¨‹åºä¼šè‡ªåŠ¨ä»ç³»ç»Ÿæºå®‰è£…ï¼ˆä¾èµ–é¡¹ï¼‰
            3. é¦–æ¬¡å®‰è£…éœ€è¦ç½‘ç»œè¿æ¥ä»¥ä¸‹è½½ä¾èµ–
            4. æ”¯æŒ x86_64 æ¶æ„ï¼ˆå…¶ä»–æ¶æ„è¯·è‡ªè¡Œç¼–è¯‘ï¼‰

      - name: "ğŸ“Š è®¾ç½®æ„å»ºçŠ¶æ€"
        id: build_status
        if: always()
        run: |
          if [ "${{ matrix.pkg_type }}" = "apk" ]; then
            echo "apk_status=${{ steps.list_files.outputs.status || 'failed' }}" >> $GITHUB_OUTPUT
          else
            echo "ipk_status=${{ steps.list_files.outputs.status || 'failed' }}" >> $GITHUB_OUTPUT
          fi

  # ========================================
  # ä»»åŠ¡ 3: ç”Ÿæˆæ„å»ºæŠ¥å‘Š
  # ========================================
  report:
    needs: [prepare, build]
    if: always() && needs.prepare.outputs.skip == 'false'
    runs-on: ubuntu-latest
    steps:
      - name: "ğŸ“Š ç”Ÿæˆæ„å»ºæŠ¥å‘Š"
        run: |
          # ä¸‹è½½æ‰€æœ‰ artifacts
          mkdir -p report
          
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          # ğŸ“Š æ„å»ºæŠ¥å‘Š
          
          ## ğŸ“‹ åŸºæœ¬ä¿¡æ¯
          
          | é¡¹ç›® | ä¿¡æ¯ |
          |------|------|
          | ğŸ·ï¸ **ç‰ˆæœ¬** | `${{ needs.prepare.outputs.tag }}` |
          | ğŸ“… **æ„å»ºæ—¶é—´** | ${{ needs.prepare.outputs.build_time }} CST |
          | ğŸ”— **ä¸Šæ¸¸ä»“åº“** | [asvow/luci-app-tailscale](https://github.com/asvow/luci-app-tailscale) |
          | ğŸ“¦ **Release** | [${{ needs.prepare.outputs.tag }}](${{ github.server_url }}/${{ github.repository }}/releases/tag/${{ needs.prepare.outputs.tag }}) |
          
          ## ğŸ”¨ ç¼–è¯‘çŠ¶æ€
          
          | åŒ…ç±»å‹ | å¹³å° | çŠ¶æ€ | ä¸‹è½½ |
          |--------|------|------|------|
          | APK | OpenWrt ä¸»çº¿ (SNAPSHOT) | ${{ needs.build.result == 'success' && 'âœ… æˆåŠŸ' || 'âŒ å¤±è´¥' }} | [apk-packages.tar.gz](${{ github.server_url }}/${{ github.repository }}/releases/download/${{ needs.prepare.outputs.tag }}/apk-packages.tar.gz) |
          | IPK | OpenWrt 24.10 | ${{ needs.build.result == 'success' && 'âœ… æˆåŠŸ' || 'âŒ å¤±è´¥' }} | [ipk-packages.tar.gz](${{ github.server_url }}/${{ github.repository }}/releases/download/${{ needs.prepare.outputs.tag }}/ipk-packages.tar.gz) |
          
          ## ğŸ“¦ åŒ…å«æ–‡ä»¶
          
          ### APK åŒ…
          
          EOF
          
          # å°è¯•ä¸‹è½½å¹¶åˆ—å‡º APK æ–‡ä»¶
          if curl -sL "${{ github.server_url }}/${{ github.repository }}/releases/download/${{ needs.prepare.outputs.tag }}/apk-packages.tar.gz" -o apk-packages.tar.gz 2>/dev/null; then
            tar -tzf apk-packages.tar.gz | while read file; do
              echo "- \`$file\`" >> $GITHUB_STEP_SUMMARY
            done
          else
            echo "> âš ï¸ æœªæ‰¾åˆ° APK åŒ…" >> $GITHUB_STEP_SUMMARY
          fi
          
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          
          ### IPK åŒ…
          
          EOF
          
          # å°è¯•ä¸‹è½½å¹¶åˆ—å‡º IPK æ–‡ä»¶
          if curl -sL "${{ github.server_url }}/${{ github.repository }}/releases/download/${{ needs.prepare.outputs.tag }}/ipk-packages.tar.gz" -o ipk-packages.tar.gz 2>/dev/null; then
            tar -tzf ipk-packages.tar.gz | while read file; do
              echo "- \`$file\`" >> $GITHUB_STEP_SUMMARY
            done
          else
            echo "> âš ï¸ æœªæ‰¾åˆ° IPK åŒ…" >> $GITHUB_STEP_SUMMARY
          fi
          
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          
          ## ğŸ“¥ å®‰è£…å‘½ä»¤
          
          ### APK (OpenWrt ä¸»çº¿)
          ```bash
          wget https://github.com/${{ github.repository }}/releases/download/${{ needs.prepare.outputs.tag }}/apk-packages.tar.gz
          tar -xzf apk-packages.tar.gz
          apk add --allow-untrusted luci-app-tailscale-*.apk
          ```
          
          ### IPK (OpenWrt 24.10)
          ```bash
          wget https://github.com/${{ github.repository }}/releases/download/${{ needs.prepare.outputs.tag }}/ipk-packages.tar.gz
          tar -xzf ipk-packages.tar.gz
          opkg install luci-app-tailscale_*_all.ipk
          ```
          
          ## ğŸ”§ ä¿®æ”¹å†…å®¹
          
          - âœ… é…ç½®æ–‡ä»¶ä¿æŠ¤ (`/etc/config/tailscale`)
          - âœ… æ•°æ®ç›®å½•è¿ç§» (`/etc/config/tailscale_data/`)
          - âœ… æˆæƒä¿¡æ¯æŒä¹…åŒ–
          - âœ… è‡ªåŠ¨ä¿®å¤å®˜æ–¹åŒ…é…ç½®é—®é¢˜
          - âœ… å›ºä»¶å‡çº§é…ç½®ä¿ç•™
          
          ## â±ï¸ æ„å»ºè€—æ—¶
          
          - **å¼€å§‹æ—¶é—´**: ${{ github.event.repository.pushed_at }}
          - **å®Œæˆæ—¶é—´**: ${{ needs.prepare.outputs.build_time }}
          
          ---
          
          <sub>ğŸ¤– ç”± GitHub Actions è‡ªåŠ¨ç”Ÿæˆ | [æŸ¥çœ‹å·¥ä½œæµ](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})</sub>
          EOF

  # ========================================
  # ä»»åŠ¡ 4: åŒæ­¥åˆ° Giteeï¼ˆå¯é€‰ï¼‰
  # ========================================
  gitee:
    needs: [prepare, build]
    if: needs.prepare.outputs.skip == 'false'
    runs-on: ubuntu-latest
    steps:
      - name: "ğŸ“¥ æ£€å‡ºä»£ç "
        uses: actions/checkout@v4

      - name: "ğŸ”„ åŒæ­¥åˆ° Gitee Release"
        continue-on-error: true
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ”„ åŒæ­¥åˆ° Gitee"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          
          if [ -f .github/scripts/release-gitee.sh ]; then
            chmod +x .github/scripts/release-gitee.sh
            .github/scripts/release-gitee.sh \
              "whzhni/luci-app-tailscale" \
              "${{ secrets.GITEE_TOKEN }}" \
              "${{ needs.prepare.outputs.tag }}" \
              "${{ needs.prepare.outputs.version }}" \
              "${{ needs.prepare.outputs.build_time }}" \
              "${{ github.repository }}" \
              "luci-app-tailscale"
            echo "âœ… åŒæ­¥å®Œæˆ"
          else
            echo "âš ï¸  æœªæ‰¾åˆ° Gitee åŒæ­¥è„šæœ¬ï¼Œè·³è¿‡"
          fi
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
