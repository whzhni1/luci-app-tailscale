name: Sync to Gitee

on:
  push:
    branches: [ main, master ]

env:
  # ä½¿ç”¨è‹±æ–‡å˜é‡å
  REPO_NAME: "luci-app-tailscale"
  GITHUB_USER: "whzhni1"
  GITEE_USER: "whzhni"

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: æ˜¾ç¤ºåŒæ­¥ä¿¡æ¯
        run: |
          echo "ğŸš€ å¼€å§‹åŒæ­¥ä»“åº“åˆ° Gitee"
          echo "ğŸ“¦ æºä»“åº“: github/${{ env.GITHUB_USER }}/${{ env.REPO_NAME }}"
          echo "ğŸ¯ ç›®æ ‡ä»“åº“: gitee/${{ env.GITEE_USER }}/${{ env.REPO_NAME }}"
          echo "ğŸ• è§¦å‘æ—¶é—´: $(date)"
          echo "ğŸ“ æäº¤ID: ${{ github.sha }}"
          echo "ğŸ”— è§¦å‘åˆ†æ”¯: ${{ github.ref }}"
          echo "ğŸ‘¤ è§¦å‘ç”¨æˆ·: ${{ github.actor }}"

      - name: æ‰§è¡ŒåŒæ­¥åˆ°Gitee
        uses: Yikun/hub-mirror-action@master
        with:
          src: github/${{ env.GITHUB_USER }}
          dst: gitee/${{ env.GITEE_USER }}
          static_list: ${{ env.REPO_NAME }}
          force_update: true
          debug: true
        env:
          GITEE_TOKEN: ${{ secrets.GITEE_TOKEN }}

      - name: åŒæ­¥æˆåŠŸé€šçŸ¥
        if: success()
        run: |
          echo "âœ… åŒæ­¥æˆåŠŸï¼Gitee ä»“åº“å·²æ›´æ–°"
          echo "ğŸ“Š æŸ¥çœ‹æœ€æ–°ä»£ç : https://gitee.com/${{ env.GITEE_USER }}/${{ env.REPO_NAME }}"
          echo "ğŸ”„ ä¸‹æ¬¡æ¨é€ä»£ç åˆ° GitHub æ—¶ä¼šè‡ªåŠ¨åŒæ­¥"
          echo "â° å®Œæˆæ—¶é—´: $(date)"

      - name: åŒæ­¥å¤±è´¥é€šçŸ¥
        if: failure()
        run: |
          echo "âŒ åŒæ­¥å¤±è´¥: ${{ env.REPO_NAME }}"
          echo "ğŸ” å¯èƒ½çš„åŸå› ï¼š"
          echo "   - Gitee Token æ— æ•ˆæˆ–è¿‡æœŸ"
          echo "   - ä»“åº“æƒé™ä¸è¶³"
          echo "   - ç½‘ç»œè¿æ¥é—®é¢˜"
          echo "   - ä»“åº“ä¸å­˜åœ¨æˆ–åç§°é”™è¯¯"
          echo "ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼š"
          echo "   1. æ£€æŸ¥ GITEE_TOKEN secret é…ç½®"
          echo "   2. ç¡®è®¤ Gitee ä»¤ç‰Œæœ‰ä»“åº“è¯»å†™æƒé™"
          echo "   3. æ£€æŸ¥ä»“åº“åç§°æ˜¯å¦æ­£ç¡®"
          echo "   4. æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—"
          echo "ğŸ†˜ éœ€è¦å¸®åŠ©è¯·æ£€æŸ¥ GitHub Actions æ—¥å¿—"
