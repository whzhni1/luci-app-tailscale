name: 同步代码到 Gitee

on:
  push:
    branches:
      - main   # 这里指定你要同步的分支，比如 main 或 master
  workflow_dispatch:  # 允许手动触发

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: 检出 GitHub 仓库代码
        uses: actions/checkout@v3
        with:
          fetch-depth: 0   # 保留完整提交历史，避免推送时出错

      - name: 设置 Git 用户信息
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: 添加 Gitee 远程仓库
        run: |
          git remote add gitee https://oauth2:${{ secrets.GITEE_TOKEN }}@gitee.com/whzhni/luci-app-tailscale.git

      - name: 推送代码到 Gitee
        run: |
          git push gitee main --force
