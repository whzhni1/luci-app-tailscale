name: "æ„å»º Tailscale_apk_ipk"

on:
  workflow_dispatch:
  schedule:
    - cron: '0 23 * * *'

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: "1ï¸âƒ£ æ£€å‡ºä»£ç "
        uses: actions/checkout@v4

      - name: "2ï¸âƒ£ æ£€æŸ¥ä¸Šæ¸¸ç‰ˆæœ¬æ›´æ–°"
        id: version
        run: |
          set -e
          
          echo "::group::ğŸ“¥ è·å–ä¸Šæ¸¸æœ€æ–°ç‰ˆæœ¬"
          upstream_latest=$(curl -s "https://api.github.com/repos/asvow/luci-app-tailscale/tags" | jq -r '.[0].name // "none"')
          
          if [ "$upstream_latest" = "none" ] || [ "$upstream_latest" = "null" ]; then
            echo "::error::âŒ æ— æ³•è·å–ä¸Šæ¸¸ç‰ˆæœ¬"
            exit 1
          fi
          
          echo "  ä¸Šæ¸¸æœ€æ–°: $upstream_latest"
          echo "::endgroup::"
          
          echo "::group::ğŸ“¦ è·å–å½“å‰ä»“åº“ç‰ˆæœ¬"
          my_latest=$(curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/tags" | jq -r '.[0].name // "none"')
          
          if [ "$my_latest" != "none" ] && [ "$my_latest" != "null" ]; then
            echo "  å½“å‰ç‰ˆæœ¬: $my_latest"
          else
            my_latest="none"
            echo "  âš ï¸  æ— ç‰ˆæœ¬ï¼ˆé¦–æ¬¡æ„å»ºï¼‰"
          fi
          echo "::endgroup::"
          
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“Š ç‰ˆæœ¬å¯¹æ¯”"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "  ä¸Šæ¸¸ç‰ˆæœ¬: $upstream_latest"
          echo "  å½“å‰ç‰ˆæœ¬: $my_latest"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          
          if [ "$upstream_latest" = "$my_latest" ]; then
            echo "::notice::âœ… ç‰ˆæœ¬ä¸€è‡´ ($upstream_latest)ï¼Œè·³è¿‡æ„å»º"
            echo "skip=true" >> $GITHUB_OUTPUT
          else
            echo "::notice::ğŸ†• å‘ç°æ–°ç‰ˆæœ¬ $upstream_latestï¼ˆå½“å‰ $my_latestï¼‰ï¼Œå¼€å§‹æ„å»º"
            echo "skip=false" >> $GITHUB_OUTPUT
            version_number=$(echo "$upstream_latest" | sed 's/^v//')
            echo "version=$version_number" >> $GITHUB_OUTPUT
            echo "tag=$upstream_latest" >> $GITHUB_OUTPUT
          fi

      - name: "âœ… ç‰ˆæœ¬æ— æ›´æ–°ï¼Œç»“æŸå·¥ä½œæµ"
        if: steps.version.outputs.skip == 'true'
        run: |
          echo "::notice::âœ… å½“å‰å·²æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œæ— éœ€é‡å¤æ„å»º"
          exit 0
          
      - name: "3ï¸âƒ£ æ‹‰å– luci-app-tailscale æºç å¹¶åšæŒä¹…åŒ–ä¿®æ”¹"
        if: steps.version.outputs.skip != 'true'
        run: |
          set -e
          SRC_DIR=$PWD/src/luci-app-tailscale
          mkdir -p src
          
          echo "ğŸ“¥ å…‹éš†æºç ..."
          git clone https://github.com/asvow/luci-app-tailscale "$SRC_DIR"
          cd "$SRC_DIR"
          
          echo "ğŸ”§ å¼€å§‹ä¿®æ”¹..."
          
          # 1. ä¿®æ”¹ Makefile - ä¿æŠ¤é…ç½®å’Œæ•°æ®
          if ! grep -q "define Package/luci-app-tailscale/conffiles" Makefile; then
            sed -i '/^PKG_VERSION:=/a\\ndefine Package/luci-app-tailscale/conffiles\n/etc/config/tailscale\n/etc/config/tailscale_data/\nendef' Makefile
            echo "âœ… Makefile: ä¿æŠ¤é…ç½®å’Œæ•°æ®ç›®å½•"
          fi
          
          # 2. ä¿®æ”¹é»˜è®¤é…ç½®
          sed -i "s|option config_path '/etc/tailscale'|option config_path '/etc/config/tailscale_data'|g" root/etc/config/tailscale
          echo "âœ… é»˜è®¤é…ç½®: config_path -> /etc/config/tailscale_data"
          
          # 3. ä¿®æ”¹ init.d è„šæœ¬
          sed -i 's|^CONFIG_PATH=/var/lib/tailscale|CONFIG_PATH=/var/run/tailscale|g' root/etc/init.d/tailscale
          sed -i '/rm -rf "$CONFIG_PATH"/i\	# åªåˆ é™¤ä¸´æ—¶ç›®å½•ï¼Œä¿æŠ¤æ•°æ®ç›®å½•' root/etc/init.d/tailscale
          echo "âœ… Init è„šæœ¬: CONFIG_PATH -> /var/run/tailscale"
          
          # 4. ä¿®æ”¹ LuCI ç•Œé¢ JS
          sed -i "s|o.default = '/etc/tailscale';|o.default = '/etc/config/tailscale_data';|g" htdocs/luci-static/resources/view/tailscale/setting.js
          echo "âœ… LuCI ç•Œé¢: é»˜è®¤è·¯å¾„ -> /etc/config/tailscale_data"
          
          # 5. ç”Ÿæˆæ™ºèƒ½ uci-defaults è„šæœ¬
          mkdir -p root/etc/uci-defaults
          
          cat > root/etc/uci-defaults/40_luci-tailscale <<'SCRIPT_EOF'
          #!/bin/sh
          
          DATA_DIR="/etc/config/tailscale_data"
          INIT_FLAG="$DATA_DIR/.initialized"
          
          # å¦‚æœå·²ç»åˆå§‹åŒ–è¿‡ï¼Œä¸”é…ç½®çœ‹èµ·æ¥æ­£ç¡®ï¼Œåˆ™è·³è¿‡
          if [ -f "$INIT_FLAG" ] && [ -f /etc/config/tailscale ]; then
          	if grep -q "^config tailscale 'settings'" /etc/config/tailscale && \
          	   grep -q "option config_path '$DATA_DIR'" /etc/config/tailscale; then
          		echo "âš ï¸  æ£€æµ‹åˆ°å·²æ­£ç¡®åˆå§‹åŒ–ï¼Œä¿ç•™ç°æœ‰é…ç½®"
          		rm -f /tmp/luci-indexcache
          		exit 0
          	fi
          fi
          
          echo "ğŸ”§ ä¿®å¤ Tailscale é…ç½®..."
          
          # æ¸…ç† opkg å¤‡ä»½
          rm -f /etc/config/tailscale-opkg
          
          # ä¿®å¤é…ç½®ï¼ˆä»…ä¿®å¤æ˜æ˜¾é”™è¯¯ï¼Œä¿ç•™ç”¨æˆ·è®¾ç½®ï¼‰
          if [ -f /etc/config/tailscale ]; then
          	NEED_FIX=0
          	
          	# æ£€æŸ¥é…ç½®æ®µç±»å‹
          	if grep -q "^config settings 'settings'" /etc/config/tailscale; then
          		echo "  - ä¿®å¤é…ç½®æ®µç±»å‹"
          		sed -i "s|^config settings 'settings'|config tailscale 'settings'|g" /etc/config/tailscale
          		NEED_FIX=1
          	fi
          	
          	# åˆ é™¤ state_fileï¼ˆä¸åº”è¯¥æ‰‹åŠ¨æŒ‡å®šï¼‰
          	if grep -q "option state_file" /etc/config/tailscale; then
          		echo "  - åˆ é™¤ state_file é€‰é¡¹"
          		sed -i "/^\s*option state_file/d" /etc/config/tailscale
          		NEED_FIX=1
          	fi
          	
          	# æ£€æŸ¥ config_path
          	if grep -q "option config_path '/etc/tailscale'" /etc/config/tailscale; then
          		echo "  - æ›´æ–° config_path"
          		sed -i "s|option config_path '/etc/tailscale'|option config_path '$DATA_DIR'|g" /etc/config/tailscale
          		NEED_FIX=1
          		
          		# è¿ç§»æ—§æˆæƒæ–‡ä»¶
          		if [ -d /etc/tailscale ] && [ -f /etc/tailscale/tailscaled.state ]; then
          			mkdir -p "$DATA_DIR"
          			cp -a /etc/tailscale/tailscaled.state "$DATA_DIR/" 2>/dev/null
          			echo "  - å·²è¿ç§»æˆæƒæ–‡ä»¶"
          		fi
          	fi
          	
          	# å¦‚æœæ²¡æœ‰ config_pathï¼Œæ·»åŠ å®ƒ
          	if ! grep -q "option config_path" /etc/config/tailscale; then
          		echo "  - æ·»åŠ  config_path"
          		sed -i "/option port/a\\	option config_path '$DATA_DIR'" /etc/config/tailscale
          		NEED_FIX=1
          	fi
          	
          	# ç¡®ä¿æœ‰ accept_dnsï¼ˆä»…åœ¨æ²¡æœ‰æ—¶æ·»åŠ ï¼‰
          	if ! grep -q "option accept_dns" /etc/config/tailscale; then
          		echo "  - æ·»åŠ  accept_dns"
          		sed -i "/option fw_mode/a\\	option accept_dns '1'" /etc/config/tailscale
          	fi
          	
          	if [ "$NEED_FIX" = "1" ]; then
          		echo "  - é…ç½®å·²ä¿®å¤ï¼Œç”¨æˆ·è®¾ç½®å·²ä¿ç•™"
          	else
          		echo "  - é…ç½®æ­£ç¡®ï¼Œæ— éœ€ä¿®æ”¹"
          	fi
          fi
          
          # ç¡®ä¿æ•°æ®ç›®å½•å­˜åœ¨
          mkdir -p "$DATA_DIR"
          
          # åˆ›å»ºåˆå§‹åŒ–æ ‡è®°
          touch "$INIT_FLAG"
          
          # æ¸…ç†ç¼“å­˜
          uci -q delete ucitrack.@tailscale[-1] 2>/dev/null
          uci -q commit ucitrack 2>/dev/null
          rm -f /tmp/luci-indexcache
          
          echo "âœ… é…ç½®æ£€æŸ¥å®Œæˆ"
          
          exit 0
          SCRIPT_EOF
          
          chmod +x root/etc/uci-defaults/40_luci-tailscale
          echo "âœ… UCI-defaults: æ™ºèƒ½é…ç½®ä¿®å¤è„šæœ¬å·²ç”Ÿæˆ"
          
          # éªŒè¯
          echo ""
          echo "ğŸ” éªŒè¯:"
          grep -q "conffiles" Makefile && echo "  âœ“ Makefile conffiles"
          grep -q "/etc/config/tailscale_data" root/etc/config/tailscale && echo "  âœ“ config_path æ­£ç¡®"
          [ -x root/etc/uci-defaults/40_luci-tailscale ] && echo "  âœ“ uci-defaults å¯æ‰§è¡Œ"
          
          echo ""
          echo "ğŸ‰ ä¿®æ”¹å®Œæˆï¼"
          echo "SRC_DIR=$SRC_DIR" >> $GITHUB_ENV
          
      # ========================================
      # ImmortalWrt ä¸»çº¿ SDK (APK)
      # ========================================
      - name: "4ï¸âƒ£ ä¸‹è½½ ImmortalWrt ä¸»çº¿ SDK (APK)"
        if: steps.version.outputs.skip != 'true'
        run: |
          set -e
          echo "ğŸ“¥ ä¸‹è½½ ImmortalWrt ä¸»çº¿ SDK..."
          SDK_URL="https://downloads.immortalwrt.org/snapshots/targets/x86/generic/immortalwrt-sdk-x86-generic_gcc-14.3.0_musl.Linux-x86_64.tar.zst"
          curl -LO "$SDK_URL"
          tar --use-compress-program=unzstd -xf "$(basename "$SDK_URL")"
          SDK_DIR=$(find . -maxdepth 1 -type d -name "immortalwrt-sdk-*" -print -quit)
          mv "$SDK_DIR" immortalwrt-sdk-apk
          echo "SDK_DIR_APK=$PWD/immortalwrt-sdk-apk" >> $GITHUB_ENV
          echo "âœ… SDK å·²è§£å‹åˆ°: immortalwrt-sdk-apk"
          
      - name: "5ï¸âƒ£ é…ç½®å¹¶ç¼–è¯‘ APK åŒ…"
        if: steps.version.outputs.skip != 'true'
        run: |
          set -e
          cd "$SDK_DIR_APK"
          
          echo "ğŸ“ é…ç½® feeds..."
          echo "src-git packages https://github.com/immortalwrt/packages.git" > feeds.conf
          echo "src-git luci https://github.com/immortalwrt/luci.git" >> feeds.conf
          ./scripts/feeds update -a
          ./scripts/feeds install -a
          
          echo "ğŸ“¦ å¤åˆ¶æºç åˆ° SDK..."
          cp -r "$SRC_DIR" package/luci-app-tailscale
          
          echo "âš™ï¸  ç”Ÿæˆé…ç½®..."
          cat > .config <<EOF
          CONFIG_TARGET_PACKAGING_APK=y
          CONFIG_PACKAGE_luci-app-tailscale=m
          CONFIG_PACKAGE_luci-i18n-tailscale-zh-cn=m
          CONFIG_PACKAGE_luci-i18n-tailscale-zh-tw=m
          # CONFIG_ALL_KMODS is not set
          EOF
          
          make defconfig
          
          echo "ğŸ”¨ å¼€å§‹ç¼–è¯‘ APK..."
          make package/luci-app-tailscale/{clean,compile} V=s -j$(nproc) IGNORE_ERRORS=m
          make package/feeds/luci/luci-i18n-tailscale-zh-cn/{clean,compile} V=s -j$(nproc) IGNORE_ERRORS=m || true
          make package/feeds/luci/luci-i18n-tailscale-zh-tw/{clean,compile} V=s -j$(nproc) IGNORE_ERRORS=m || true
          
          echo "ğŸ“¦ æ”¶é›† APK äº§ç‰©..."
          mkdir -p ../out-apk
          find bin/packages -type f -name "luci-app-tailscale*.apk" -exec cp -v {} ../out-apk/ \;
          find bin/packages -type f -name "luci-i18n-tailscale*.apk" -exec cp -v {} ../out-apk/ \;
          
          echo "âœ… APK ç¼–è¯‘å®Œæˆ"
          
      - name: "6ï¸âƒ£ éªŒè¯ APK äº§ç‰©"
        if: steps.version.outputs.skip != 'true'
        run: |
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“¦ APK äº§ç‰©åˆ—è¡¨"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          ls -lh out-apk/ || echo "âš ï¸  æœªæ‰¾åˆ° APK æ–‡ä»¶"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          
      # ========================================
      # ImmortalWrt 24.10 SDK (IPK)
      # ========================================
      - name: "7ï¸âƒ£ ä¸‹è½½ ImmortalWrt 24.10 SDK (IPK)"
        if: steps.version.outputs.skip != 'true'
        run: |
          set -e
          echo "ğŸ“¥ ä¸‹è½½ ImmortalWrt 24.10 SDK..."
          SDK_URL="https://downloads.immortalwrt.org/releases/24.10.0/targets/x86/64/immortalwrt-sdk-24.10.0-x86-64_gcc-13.3.0_musl.Linux-x86_64.tar.zst"
          curl -LO "$SDK_URL"
          tar --use-compress-program=unzstd -xf "$(basename "$SDK_URL")"
          SDK_DIR_RAW=$(find . -maxdepth 1 -type d -name "immortalwrt-sdk-*" ! -name "*-apk" -print -quit)
          mv "$SDK_DIR_RAW" immortalwrt-sdk-ipk
          echo "SDK_DIR_IPK=$PWD/immortalwrt-sdk-ipk" >> $GITHUB_ENV
          echo "âœ… SDK å·²è§£å‹åˆ°: immortalwrt-sdk-ipk"
          
      - name: "8ï¸âƒ£ é…ç½®å¹¶ç¼–è¯‘ IPK åŒ…"
        if: steps.version.outputs.skip != 'true'
        run: |
          set -e
          cd "$SDK_DIR_IPK"
          
          echo "ğŸ“ é…ç½® feeds..."
          echo "src-git packages https://github.com/immortalwrt/packages.git" > feeds.conf
          echo "src-git luci https://github.com/immortalwrt/luci.git" >> feeds.conf
          ./scripts/feeds update -a
          ./scripts/feeds install -a
          
          echo "ğŸ“¦ å¤åˆ¶æºç åˆ° SDK..."
          cp -r "$SRC_DIR" package/luci-app-tailscale
          
          echo "âš™ï¸  ç”Ÿæˆé…ç½®..."
          cat > .config <<EOF
          CONFIG_PACKAGE_luci-app-tailscale=m
          CONFIG_PACKAGE_luci-i18n-tailscale-zh-cn=m
          CONFIG_PACKAGE_luci-i18n-tailscale-zh-tw=m
          # CONFIG_ALL_KMODS is not set
          EOF
          
          make defconfig
          
          echo "ğŸ”¨ å¼€å§‹ç¼–è¯‘ IPK..."
          make package/luci-app-tailscale/{clean,compile} V=s -j$(nproc) IGNORE_ERRORS=m
          make package/feeds/luci/luci-i18n-tailscale-zh-cn/{clean,compile} V=s -j$(nproc) IGNORE_ERRORS=m || true
          make package/feeds/luci/luci-i18n-tailscale-zh-tw/{clean,compile} V=s -j$(nproc) IGNORE_ERRORS=m || true
          
          echo "ğŸ“¦ æ”¶é›† IPK äº§ç‰©..."
          mkdir -p ../out-ipk
          find bin/packages -type f -name "luci-app-tailscale*.ipk" -exec cp -v {} ../out-ipk/ \;
          find bin/packages -type f -name "luci-i18n-tailscale*.ipk" -exec cp -v {} ../out-ipk/ \;
          
          echo "âœ… IPK ç¼–è¯‘å®Œæˆ"
          
      - name: "9ï¸âƒ£ éªŒè¯ IPK äº§ç‰©"
        if: steps.version.outputs.skip != 'true'
        run: |
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“¦ IPK äº§ç‰©åˆ—è¡¨"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          ls -lh out-ipk/ || echo "âš ï¸  æœªæ‰¾åˆ° IPK æ–‡ä»¶"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          
      # ========================================
      # æ±‡æ€» & å‘å¸ƒ
      # ========================================
      - name: "ğŸ”Ÿ æ±‡æ€»äº§ç‰©"
        if: steps.version.outputs.skip != 'true'
        run: |
          set -e
          mkdir -p out
          
          echo "ğŸ“¦ æ±‡æ€» APK æ–‡ä»¶..."
          for file in out-apk/*; do
            [ -f "$file" ] || continue
            filename=$(basename "$file")
            if [[ "$filename" == luci-app-tailscale* ]] || [[ "$filename" == luci-i18n-tailscale* ]]; then
              cp -v "$file" out/
            fi
          done
          
          echo "ğŸ“¦ æ±‡æ€» IPK æ–‡ä»¶..."
          for file in out-ipk/*; do
            [ -f "$file" ] || continue
            filename=$(basename "$file")
            if [[ "$filename" == luci-app-tailscale* ]] || [[ "$filename" == luci-i18n-tailscale* ]]; then
              cp -v "$file" out/
            fi
          done
          
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“¦ æœ€ç»ˆäº§ç‰©ï¼ˆå·²è¿‡æ»¤ä¾èµ–åŒ…ï¼‰"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          ls -lh out/
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

      - name: "1ï¸âƒ£1ï¸âƒ£ ç”Ÿæˆæ„å»ºæ—¶é—´"
        if: steps.version.outputs.skip != 'true'
        id: build_time
        run: |
          BUILD_TIME=$(TZ=Asia/Shanghai date +"%Y-%m-%d %H:%M:%S")
          echo "time=$BUILD_TIME" >> $GITHUB_OUTPUT
          echo "ğŸ“… æ„å»ºæ—¶é—´: $BUILD_TIME CST"

      - name: "1ï¸âƒ£2ï¸âƒ£ å‘å¸ƒåˆ° GitHub Release"
        if: steps.version.outputs.skip != 'true'
        uses: softprops/action-gh-release@v1
        with:
          tag_name: "${{ steps.version.outputs.tag }}"
          name: "luci-app-tailscale ${{ steps.version.outputs.version }}"
          files: "out/*"
          body: |
            ## ğŸ“¦ åŒ…å«æ–‡ä»¶
            - **APK æ ¼å¼**ï¼šé€‚ç”¨äº ImmortalWrt ä¸»çº¿ï¼ˆæ–°ç‰ˆ apk åŒ…ç®¡ç†å™¨ï¼‰
            - **IPK æ ¼å¼**ï¼šé€‚ç”¨äº ImmortalWrt 24.10 åŠä»¥ä¸‹ï¼ˆä¼ ç»Ÿ opkg åŒ…ç®¡ç†å™¨ï¼‰

            ## ğŸ”§ æŒä¹…åŒ–é…ç½®è¯´æ˜
            - **é…ç½®æ–‡ä»¶**ï¼š`/etc/config/tailscale`
            - **æ•°æ®ç›®å½•**ï¼š`/etc/config/tailscale_data/`
            - **æˆæƒæ–‡ä»¶**ï¼š`/etc/config/tailscale_data/tailscaled.state`
            
            âœ… é‡æ–°å®‰è£…ã€å‡çº§å›ºä»¶æ—¶é…ç½®å’Œæˆæƒä¿¡æ¯å‡ä¸ä¸¢å¤±

            ## ğŸ“¥ å®‰è£…æ–¹æ³•
            
            ### APK æ–¹å¼ï¼ˆImmortalWrt ä¸»çº¿ï¼‰
            ```bash
            apk add --allow-untrusted luci-app-tailscale*.apk
            apk add --allow-untrusted luci-i18n-tailscale-zh-cn*.apk  # å¯é€‰ï¼šä¸­æ–‡è¯­è¨€åŒ…
            ```

            ### IPK æ–¹å¼ï¼ˆImmortalWrt 24.10 åŠä»¥ä¸‹ï¼‰
            ```bash
            opkg install luci-app-tailscale*.ipk
            opkg install luci-i18n-tailscale-zh-cn*.ipk  # å¯é€‰ï¼šä¸­æ–‡è¯­è¨€åŒ…
            ```

            ## ğŸ“Œ ç‰ˆæœ¬ä¿¡æ¯
            - **ä¸Šæ¸¸ç‰ˆæœ¬**: ${{ steps.version.outputs.tag }}
            - **æ„å»ºæ—¶é—´**: ${{ steps.build_time.outputs.time }} CST
            - **åŒ…å«è¯­è¨€**: English, ç®€ä½“ä¸­æ–‡, ç¹é«”ä¸­æ–‡

            ## âš ï¸ æ³¨æ„äº‹é¡¹
            1. ä»…åŒ…å« LuCI ç•Œé¢æ’ä»¶å’Œè¯­è¨€åŒ…
            2. Tailscale ä¸»ç¨‹åºå’Œä¾èµ–åº“è¯·ä»ç³»ç»Ÿæºè‡ªåŠ¨å®‰è£…
            3. é¦–æ¬¡å®‰è£…ä¼šè‡ªåŠ¨ä»å®˜æ–¹æºæ‹‰å– `tailscale` ä¾èµ–åŒ…

            ## ğŸ”„ æ›´æ–°è¯´æ˜
            - è‡ªåŠ¨ä¿æŠ¤é…ç½®æ–‡ä»¶å’Œæˆæƒä¿¡æ¯
            - æ”¯æŒå›ºä»¶å‡çº§æ—¶ä¿ç•™é…ç½®ï¼ˆå‹¾é€‰ä¿ç•™é…ç½®ï¼‰
            - ä¿®å¤å®˜æ–¹ tailscale åŒ…ç”Ÿæˆçš„é…ç½®é—®é¢˜

      - name: "1ï¸âƒ£3ï¸âƒ£ åŒæ­¥åˆ° Gitee Release"
        if: steps.version.outputs.skip != 'true'
        continue-on-error: true
        run: |
          chmod +x .github/scripts/release-gitee.sh
          .github/scripts/release-gitee.sh \
            "whzhni/luci-app-tailscale" \
            "${{ secrets.GITEE_TOKEN }}" \
            "${{ steps.version.outputs.tag }}" \
            "${{ steps.version.outputs.version }}" \
            "${{ steps.build_time.outputs.time }}" \
            "${{ github.repository }}" \
            "luci-app-tailscale"
